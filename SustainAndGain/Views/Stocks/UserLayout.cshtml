@model SustainAndGain.Models.ModelViews.CompetitionVM[]
@{
    ViewData["Title"] = "UserLayout";
}
<link href="~/css/UserLayout.css?t=<%= @DateTime.Now.Ticks %>" rel="stylesheet" />

<div class="navbar">

    <ul>

        <li>
            <img src="~/Img/profile.png" />

        </li>
        <li>
            <img src="~/Img/Plusprofile.png" />

        </li>
        <li>

            <img src="~/Img/Userprofile.png" />

        </li>
    </ul>

</div>

@* SLides for tävlingar *@
<h2>Tävling</h2>
<div class="slideContainer">
    <div id="slide1" class="slide">
        <p>Competition: @Model[0].Name</p>

        <p>Starting: @Model[0].StartTime</p>
        <p>Ends: @Model[0].EndTime</p>
        <p>@Model[0].IsOngoing </p>
        <div id="ButtonJavaDiv0"></div>
       

        @if (Model[0].HasJoined)

        {
            <div id="ButtonDiv0"></div>

        }
        else
        {
            <input id="Join0" type="submit" value="Join" class="btn btn-primary" />

        }

    </div>
    <div class="slide">
        <p>
            Competition: @Model[1].Name
        </p>

        <p>Starting: @Model[1].StartTime</p>
        <p>Ends: @Model[1].EndTime</p>
        <p>@Model[1].IsOngoing </p>
        <div id="ButtonJavaDiv1"></div>

        @if (Model[1].HasJoined)

        {
            <div id="ButtonDiv1"></div>

        }
        else
        {
            <input id="Join1" type="submit" value="Join" class="btn btn-primary" />

        }
    
        
      

    </div>
    <div class="slide">
        <p>Competition: @Model[2].Name</p>

        <p>Starting: @Model[2].StartTime</p>
        <p>Ends: @Model[2].EndTime</p>
        <p>@Model[2].IsOngoing </p>

        <div id="ButtonJavaDiv2"></div>



        @if (Model[2].HasJoined)

        {
            <div id="ButtonDiv2"></div>

        }
        else
        {
            <input id="Join2" type="submit" value="Join" class="btn btn-primary" />

        }
        <form>
            <button asp-controller="PortFolio"
                    asp-action="Portfolio"
                    asp-route-id="@Model[1].Id">
                Go To Portfolio
            </button>
        </form>;
        <a asp-controller="PortFolio" asp-action="Portfolio" asp-route-id="@Model[0].Id">dfdfgdg</a>


    </div>
    <div class="slide">
        <p>Competition: @Model[3].Name</p>

        <p>Starting: @Model[3].StartTime</p>
        <p>Ends: @Model[3].EndTime</p>
        <p>@Model[3].IsOngoing </p>
        <div id="ButtonJavaDiv3"></div>
     

        @if (Model[3].HasJoined)

        {
            <div id="ButtonDiv3"></div>

        }
        else
        {
            <input id="Join3" type="submit" value="Join" class="btn btn-primary" />

        }

    </div>
    @*@{ 
        Html.RenderPartial("Chart");

    }*@

</div>

<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.17.0/jquery.validate.min.js"></script>
<script src="https://ajax.aspnetcdn.com/ajax/mvc/5.2.3/jquery.validate.unobtrusive.min.js"></script>
<script>
      let codeblocks = []

        @foreach (var item in Model)
        {
            @:codeblocks.push([@item.Id])
        }



    window.onload = function AddButton() {
      



        var stringForJava = `ButtonJavaDiv` 
        var string = `ButtonDiv`
        for (var i = 0; i < 4; i++) {

            var element = document.getElementById(string + `${i}`);
            var element2 = document.getElementById(stringForJava + `${i}`);
            if (element == null) {
                
            }
            else {
                this.console.log("running")

                   element.innerHTML = `  <form>
                <button asp-controller="PortFolio"
                        asp-action="Portfolio"
                        asp-route-id="${codeblocks[i]}">
                    Go To Portfolio
                </button>
                </form>`;
                this.console.log("finished")
            }
           
            if (element2 == null) {
                
            }
            else {
                 element2.innerHTML = `  <form>
                <button asp-controller="PortFolio"
                        asp-action="Portfolio"
                        asp-route-id="${codeblocks[i]}">
                    Go To Portfolio
                </button>
                </form>`;
            }
           

           

              
        }
    }
    





  

    $(document).ready(function () {
          $("#Join0").click(function () {
            Join(0);
        })
         $("#Join1").click(function () {
            Join(1);
         })
         $("#Join2").click(function () {
            Join(2);
         })
         $("#Join3").click(function () {
            Join(3);
        })

        //Reading text box values using Jquery
        function Join(number) {
            var obj = { "UserId": "@Model[0].UserId", "CompId": String(codeblocks[number]) };
            $.ajax(
                {
                    type: "POST", //HTTP POST Method
                    url: "Stocks/InsertAjax",
                     contentType: 'application/json',
                    data: JSON.stringify(obj),
                    success: function () {
                        $(`#Join${number}`).css("display", "none");
                        $(`#ButtonJavaDiv${number}`).css("display", "block");
                        AddButton();

                    },
                    error: function () {
                        $("#messageDiv").html();
                    }
                }

            );

    }
   
        
       
                        })

</script>


